# kernelhack
http://www.coins.tsukuba.ac.jp/~yas/coins/slab-kernel-2015/
これは私的なリポジトリのため後輩の役には立ちません。

## 課題1 カーネルのコンパイルとパラメタの設定
files/config\_template や tools/kerninst.sh を参照のこと
## 課題2 カーネルのリモート・デバッグ
## 課題3 システムコールの追加
syscall/ にカーネル空間でのシステムコール実装とそれを呼び出すユーザー空間のプログラムがある
## 課題4 デバイス・ドライバの作成
driver/
## 課題9 その他
TUNデバイスを使ってL3のVPNをしてみる
UDPでパケットを飛ばし、Peer to peerなVPN
### つかいかた(myvpn.c)
myvpn.cはサーバー・クライアントの概念はありません。Peer to Peerな関係です。
通信は一対一で、相互とも相手を指定する必要があります。また、NAT環境下などでは利用できません。
どちらからもUDPが届く必要があります。


ピアA
./myvpn -a 172.16.5.129 -p 12345 -t "ifconfig %s 192.168.1.1 mtu 1450  pointopoint 192.168.1.2"
ピアB
./myvpn -a 172.16.5.1 -p 12345 -t "ifconfig %s 192.168.1.2 mtu 1450 pointopoint 192.168.1.1" 

-aが相手のIPアドレス、pが接続先ポートです。申し訳ないがリッスンポート12345はハードコードされていて引数からのインターフェイスはない。
このプログラムを実行するとPeer-to-peerなTUNが作成されます。tunのMTUは1450で、理由は、標準的な1500にしてしまうと、それに対してUDPヘッダをエンカプセレーションで付けてしまって1500以上になり、1つの元のパケットが2つに別れてしまうフラグメントが発生します。
そうなるとオーバーヘッドになるので、tunを最初から1450にしてそういうことを防止しています。

